---
title: "Javascript: Outils de dev et dÃ©ploiement"
date: 2021-01-11T13:00:13+09:00
categories:
  - front
  - tools
  - code
description: "Un tour des diffÃ©rents outils que jâ€™utilise pour gÃ©rer mon development et le dÃ©ploiement de mon blog"
---

Dans un prÃ©cÃ©dent article je vous ai exposÃ© lâ€™ensemble des outils que jâ€™utilise pour automatiser le dÃ©ploiement dâ€™une gem. Aujourdâ€™hui, je vais vous prÃ©senter ma stack pour un projet NextJS ou tout autre projet Ã  base de JS.

L'article sera scindÃ© en deux bouts: une partie sur les outils que jâ€™utilise au moment du development et une partie sur les outils utiles au moment du dÃ©ploiement. On va voir quâ€™on a pas du tout les mÃªmes besoin et attentes dans les deux cas mÃªme si certaines problÃ©matiques se ressemblent.

## Development

En tant que dÃ©veloppeur les point le plus importants sont:

- La vitesse Ã  laquelle jâ€™ai du feedback : Si je dois attendre 2 sec Ã  chaque fois que je sauve un fichier pour savoir si ce que jâ€™ai fait est correct Ã§a va me sortir de mon flow de pensÃ©es le temps que jâ€™ai le retour. La productivitÃ© sera vraiment rÃ©duite.
- Detecter les erreurs au plus tÃ´t : Il faut que les outils soient disponibles de faÃ§on quasi automatique pendant le dÃ©veloppement et pas quand je dÃ©ciderai de commit et que je me rend compte des centaines dâ€™erreurs.
- Ne pas se mettre en travers de mon chemin : Si un outil bloque mon flow de pensÃ©e pour me forcer a fixer des erreurs de syntaxe, cet outil va juste me ralentir.
- GÃ©rer pour moi une partie de la complexitÃ© : Si lâ€™outil me permet dâ€™oublier une partie des choses et celui-ci me rappellera que je suis un â€œ_idiot_â€ en me proposant la solution câ€™est parfait.

On va voir quâ€™on a rarement tout en mÃªme temps et quâ€™en gÃ©nÃ©ral on doit composer avec certains dÃ©fauts car ils sont Ã©crasÃ©s par les bÃ©nÃ©fices de lâ€™outil.

### TypeScript

Pour ceux qui ne le savent pas, quâ€™est-ce que TypeScript: Câ€™est un langage dÃ©veloppÃ© par Microsoft qui sera transformÃ© en JS. Il ajoute la notion de â€œtypeâ€ aux dÃ©clarations de constantes et de fonctions et vÃ©rifie que ce type est respectÃ©/consistant au travers de notre application. De nombreux IDEs on une trÃ¨s bonne intÃ©gration avec TypeScript en sâ€™en servant pour faire de lâ€™autocompletion et afficher de la documentation.

VoilÃ  un exemple succinct de TS (un article ne parlant que de Ã§a verra surement le jour dans les prochaines semaines/mois).

```ts
type Item = {
  key: string;
  properties: Array<{ name: string; value: string | number }>;
};

const item: Item = {
  key: "table",
  properties: [{ name: "legs", value: 4 }],
};

const countLegs = (items: Array<Item>) =>
  items.reduce<number>(
    (res, item) =>
      res + (item.properties.find((e) => e.name === "legs")?.value || 0)
  );
```

Venant de Ruby, mettre Ã  nouveau un type Ã  mes objets fut trÃ¨s Ã©trange. Mais aprÃ¨s mâ€™Ãªtre fait brÃ»ler â€œ_quelques_â€ fois par les â€œparticularitÃ©sâ€ de JS ou des librairies associÃ©es, je trouve que typescript me sauve plus de temps quâ€™il ne mâ€™en coute.

Cet outil nâ€™est clairement pas sans dÃ©fauts ğŸ˜¶ Et on va en lister ici quelques uns.

- Les erreurs: Lire une erreur TS est a peu prÃ¨s aussi utile que lire un roman dans une langue Ã©trangÃ¨re inconnue et quâ€™on ne veut pas apprendre. Elles sont obscures et nâ€™aident pas du tout Ã  leur rÃ©solution. Bien heureusement, on apprend petit Ã  petit Ã  ne plus tomber dans les piÃ¨ges qui les font sortir du bois. Ici, TS se met en travers du chemin.
- Typer les choses prends du tempsÂ : ajouter des dÃ©clarations de type partout, prendre le temps de comprendre comment marche le typage et rÃ©flÃ©chir en amont Ã  la forme des objets qui seront utilisÃ©s, va clairement ralentir la cadence.
- Typer les choses est moins flexible et parfois difficile (notamment quand on veut crÃ©er des fonctions un peu gÃ©nÃ©riques qui acceptent plusieurs types)

Mais la force de cet outil se trouve dans ce genre de cas:

```ts
// <input type="text" onchange="onChange">
const onChange = (event) => {
  event.current.target;
  event.target;
};
```

Seriez vous capable de me donner la liste des mÃ©thodes prÃ©sentes sur `event.target` et `event.current.target` et Ãªtre sur que vous les utilisÃ©es avec le bon types dâ€™arguments ? Moiâ€¦ non. TS, oui.

Typescript, mÃªme si il est parfois dans mon chemin, me libÃ¨re Ã©normÃ©ment dâ€™espace mental quant au format des choses que je vais recevoir et comment les utiliser. De plus il me trouve des erreurs avant mÃªme quâ€™elles nâ€™arriventâ€¦ Dans le navigateur des clients.

##### Activer TS dans un projet NextJS

Pour ceux qui cherchent la faÃ§on de lâ€™activer et lâ€™utiliser dans NextJS il suffit de faire, Ã  la racine de votre projetÂ : `touch tsconfig.json` et de relancer votre serveur de dev. Votre projet acceptera maintenant les fichiers `.ts` et `.tsx`.

Pour un peu plus dâ€™informations, je vous renvoie vers [la page de documentation correspondante](https://nextjs.org/docs/basic-features/typescript)

Maintenant quâ€™on a un outil qui dÃ©tecte une partie des erreurs et gÃ¨re la documentation du code. On va rÃ©gler les problÃ©matiques de style.

### Prettier

[Prettier](https://prettier.io), est un outil qui permet de formater le code de maniÃ¨re automatique. Les principales diffÃ©rences avec [Rubocop](http://rubocop.org/) ou [Eslint](#eslint) sont les suivantesÂ :

- Prettier utilise un [AST](https://prettier.io/docs/en/index.html) pour reformater le code. PlutÃ´t quâ€™un outil qui ne comprend pas vraiment la logique dâ€™une ligne de code, prettier va dÃ©composer vos lignes de code sous la forme dâ€™un arbre et sâ€™en servir pour rendre un code qui suit ses diffÃ©rentes rÃ¨gles. Prettier Ã  donc beaucoup plus de facilitÃ©es Ã  traiter des lignes complexes et/ou forcer des sauts de ligne aux bons endroits.
- Prettier nâ€™a presque pas dâ€™options de configuration. Lâ€™idÃ©e est de couper les â€œ_nombreuses_â€ discussions inutiles qui apparaissent lorsquâ€™on dÃ©cide de la faÃ§on dont on va formater notre code. Comme beaucoup de projets se sont mis Ã  utiliser Prettier, Ã  travers lâ€™Ã©cosystÃ¨me javascript, beaucoup de projets ont un look trÃ¨s similaire maintenant.
- Prettier nâ€™a pas de rÃ¨gles quant Ã  la qualitÃ© de code. Prettier nâ€™a aucun problÃ¨me Ã  ce que votre code ait des variables inutilisÃ©es ou encore des rÃ¨gles de performance/sÃ©curitÃ©.

##### Comment ajouter Prettier Ã  un projet ?

On commence par ajouter prettier Ã  nos outils de development.

```bash
 yarn add -D prettier
```

On est maintenant capable de lancer la commande

```bash
yarn prettier --writte mon/path/vers/mon/fichier.ts
```

Et voilÃ . Je ne vais pas parler de lâ€™intÃ©gration entre prettier et un Ã©diteur car on va voir quâ€™on utilisera quasiment jamais prettier seul. On va utiliser un autre outil pour le lancer. Cet outil sera aussi responsable de gÃ©rer les rÃ¨gles de qualitÃ© de code.

### ESlint

ESlint est Ã  Javascript ce que Rubocop est Ã  ruby. Câ€™est un linter, trÃ¨s configurable qui prend en charge un grand Ã©ventail de rÃ¨gles et de plugins.

##### Style dâ€™Airbnb

##### IntÃ©gration avec Prettier

##### IntÃ©gration avec Typescript

##### Configuration finale et commentaires

VoilÃ  ma configuration pour eslint que jâ€™utilise pour tous mes projets React/NextÂ :

<FileName blogGithub filename=".eslintrc.js" />

```js
module.exports = {
  root: true,
  parser: "@typescript-eslint/parser",
  extends: [
    "airbnb",
    "prettier",
    "plugin:prettier/recommended",
    "prettier/react",
    "plugin:@typescript-eslint/eslint-recommended",
    "plugin:@typescript-eslint/recommended",
    "plugin:import/typescript",
  ],
  env: {
    browser: true,
    node: true,
    jquery: true,
    jest: true,
  },
  rules: {
    // Certains pattern de variables peuvent ne pas Ãªtre utilisÃ©es.
    "no-unused-vars": [
      1,
      {
        argsIgnorePattern: "res|next|Sequelize|^err|^_.*",
      },
    ],
    // const > let >>>> var
    // On va aussi destructurer les object autant que possible
    "prefer-const": [
      "error",
      {
        destructuring: "all",
      },
    ],
    // Les arrow function auront des {} seulement si nÃ©cessaire.
    "arrow-body-style": [2, "as-needed"],
    // Detecte les cas ou des lignes sont inutilisÃ©es
    // Le allowTaggedTemplates est lÃ  pour de la compatibilitÃ© avec
    // styled-components
    "no-unused-expressions": [
      2,
      {
        allowTaggedTemplates: true,
      },
    ],
    "no-param-reassign": [
      2,
      {
        props: false,
      },
    ],
    // On autorise les console.log car je l'utilise trop souvent en debug
    // pour accepter que JS me crie dessus.
    "no-console": 0,
    // Il y a des cas oÃ¹ on veut juste un named export dans un fichier
    // nottament en cours de dev. Je ne suis pas sÃ»r qu'il y ait un rÃ©el
    // intÃ©rÃªt Ã  cette rÃ¨gle qui vient de AirBnb.
    "import/prefer-default-export": 0,
    import: 0,
    // Il y a des cas oÃ¹ on va vouloir des fonctions anonymes en JS
    "func-names": 0,
    // J'aime bien ne pas avoir d'espace avant les () dans une dÃ©claration
    "space-before-function-paren": 0,
    // C'est le taf de prettier
    "comma-dangle": 0,
    "max-len": 0,
    "import/extensions": 0,
    "no-underscore-dangle": 0,
    // Il y a des cas tout Ã  fait valide de renvoyer soit null soit
    // un objet dans une fonction. C'est le travail de TS de trouver
    // ces erreurs.
    "consistent-return": 0,
    // Chaque composant doit avoir un nom. C'est affreux a debug sinon.
    "react/display-name": 1,
    "react/no-array-index-key": 0,
    "react/react-in-jsx-scope": 0,
    "react/prefer-stateless-function": 0,
    "react/forbid-prop-types": 0,
    "react/no-unescaped-entities": 0,
    // Emoji everywhere
    "jsx-a11y/accessible-emoji": 0,
    "react/require-default-props": 0,
    // On liste les extensions de fichiers qui peuvent contenir du JSX
    "react/jsx-filename-extension": [
      1,
      {
        extensions: [".js", ".jsx", ".ts", ".tsx"],
      },
    ],
    radix: 0,
    // Ã‡a sera gÃ©rÃ© par Prettier
    quotes: [
      2,
      "single",
      {
        avoidEscape: true,
        allowTemplateLiterals: true,
      },
    ],
    // On configure prettier
    "prettier/prettier": [
      "error",
      {
        trailingComma: "es5",
        singleQuote: true,
        printWidth: 80,
        semi: true,
      },
    ],
    // Des fois c'est pratique d'avoir des liens avec
    // '#' ou des valeurs invalides comme href
    // lors du prototypage.
    "jsx-a11y/href-no-hash": "off",
    "jsx-a11y/anchor-is-valid": [
      "warn",
      {
        aspects: ["invalidHref"],
      },
    ],
    // Marquer le non-repect des rÃ¨gles de hook comme des erreurs.
    "react-hooks/rules-of-hooks": "error",
    // Marquer le fait qu'il manque des dÃ©pendances dans les useEffect
    // comme un warning.
    "react-hooks/exhaustive-deps": "warn",
    // Les 2 rÃ¨gles suivantes sont lÃ  pour autoriser
    // Ã  ce que les fonctions et modules ne soient pas typÃ©s.
    // En effet, dans un contexte React, la plupart du temps nos
    // fonctions seront des composants et leur typage sera inutile.
    "@typescript-eslint/explicit-function-return-type": 0,
    "@typescript-eslint/explicit-module-boundary-types": 0,
    // La plupart du temps on veut que eslint hurle quand des variables
    // ne sont pas utilisÃ©es. On autorise certains patterns classiques.
    // notemment les variables commenÃ§ant par _
    "@typescript-eslint/no-unused-vars": [
      1,
      {
        argsIgnorePattern: "res|next|Sequelize|^err|^_.*",
      },
    ],
    // Les deux rÃ¨gles suivantes sont prÃ©sente pour un dÃ©faut de
    // compatibilitÃ© entre ESlint et Typescript.
    // On desactive les rÃ¨gles de ESLint et
    // on active les rÃ¨gles de typescript-eslint correspondantes.
    "no-use-before-define": "off",
    "@typescript-eslint/no-use-before-define": ["error"],
    "no-shadow": "off",
    "@typescript-eslint/no-shadow": ["error"],
  },
  // Les diffÃ©rents plugins
  plugins: ["prettier", "react-hooks", "@typescript-eslint"],
  // Ces fichiers ne sont pas Ã©crits par nous.
  ignorePatterns: ["next-env.d.ts", "node_modules/", "/public/"],
};
```

##### IntÃ©gration avec VSCode

## DÃ©ploiment

### Husky + lint-staged

### Vercel

## Conclusion
